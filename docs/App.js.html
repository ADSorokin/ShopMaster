<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: App.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: App.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Главный компонент приложения "ShopMaster" — управляет состоянием, навигацией и рендерингом страниц.
 *
 * @component
 * @example
 * return &lt;App />;
 *
 * @description
 * Этот компонент:
 * - Управляет глобальным состоянием (корзина, пользователь, заказы, фильтры и т.д.)
 * - Реализует навигацию между страницами
 * - Обрабатывает взаимодействия (добавление в корзину, вход, заказ и др.)
 * - Рендерит основные UI-элементы: хедер, футер, виджет чата, модальные окна
 *
 * Поддерживает мультиязычность (ru) и мультивалютность (RUB).
 */
import { useState} from 'react';
import Header from './components/Header';
import Footer from './components/Footer';
import Breadcrumb from './components/Breadcrumb';
import ProductPage from './pages/ProductPage';
import HomePage from './pages/HomePage';
import CartPage from './pages/CartPage';
import CheckoutPage from './pages/CheckoutPage';
import OrdersPage from './pages/OrdersPage';
import LoginPage from './pages/LoginPage';
import FavoritesPage from './pages/FavoritesPage';
import ComparePage from './pages/ComparePage';
import ChatWidget from './components/ChatWidget';
import OrderModal from './components/OrderModal';
import AddToCartAnimation from './components/AddToCartAnimation';

// Импорт данных и утилит
import { products } from './data/products';         // Список всех товаров
import { categories } from './data/categories';     // Категории товаров
import { pickupPoints } from './data/pickupPoints'; // Пункты самовывоза
import { currencies } from './data/currencies';     // Валюты (RUB, USD и т.д.)

import { formatPrice, getCartTotals } from './utils/helpers'; // Форматирование цен и подсчёт сумм в корзине

const App = () => {
    // === Состояние приложения ===

    /** @type {string} Текущая страница: 'home', 'product', 'cart', 'checkout', и т.д. */
    const [currentPage, setCurrentPage] = useState('home');

    /** @type {Object|null} Текущий выбранный продукт (для детальной страницы) */
    const [currentProduct, setCurrentProduct] = useState(null);

    /** @type {Array} Корзина: список товаров с количеством и опциями */
    const [cart, setCart] = useState([]);

    /** @type {Array} История заказов пользователя */
    const [orders, setOrders] = useState([]);

    /** @type {string} Выбранная категория ('all' или ID категории) */
    const [selectedCategory, setSelectedCategory] = useState('all');

    /** @type {string} Поисковый запрос */
    const [searchTerm, setSearchTerm] = useState('');

    /** @type {boolean} Отображение модального окна успешного заказа */
    const [showOrderModal, setShowOrderModal] = useState(false);

    /** @type {boolean} Отображение виджета чата */
    const [showChat, setShowChat] = useState(false);

    /** @type {Object|null} Данные авторизованного пользователя */
    const [user, setUser] = useState(null);

    /** @type {Object} Фильтры товаров: диапазон цен, бренд, рейтинг */
    const [filters, setFilters] = useState({
        priceRange: [0, 200000],
        brand: '',
        rating: 0
    });

    /** @type {Array} Последние просмотренные товары (до 5) */
    const [viewedProducts, setViewedProducts] = useState([]);

    /** @type {Array&lt;number>} ID избранных товаров */
    const [favorites, setFavorites] = useState([]);

    /** @type {Array&lt;number>} ID товаров для сравнения */
    const [compareList, setCompareList] = useState([]);

    /** @type {Array&lt;Object>} Уведомления пользователя */
    const [notifications, setNotifications] = useState([
        { id: 1, type: 'sale', message: 'Скидка 20% на электронику!', time: '10 мин назад', read: false },
        { id: 2, type: 'order', message: 'Ваш заказ №12345 отправлен!', time: '1 час назад', read: false }
    ]);

    /** @type {Array&lt;Object>} Сообщения в чате */
    const [chatMessages, setChatMessages] = useState([
        { id: 1, sender: 'bot', text: 'Здравствуйте! Чем могу помочь?', time: '10:30' }
    ]);

    /** @type {string} Текст ввода в чате */
    const [chatInput, setChatInput] = useState('');

    /** @type {boolean} Анимация добавления в корзину */
    const [showAddAnimation, setShowAddAnimation] = useState(false);

    /** @type {boolean} Режим голосового поиска */
    const [showVoiceSearch, setShowVoiceSearch] = useState(false);

    /** @type {Object} Форма оформления заказа (шаг, доставка, оплата) */
    const [orderForm, setOrderForm] = useState({
        step: 1,
        delivery: {
            type: 'courier',
            address: '',
            city: '',
            phone: ''
        },
        payment: {
            method: 'card',
            cardNumber: '',
            expiry: '',
            cvv: ''
        }
    });

    /** @type {Object|null} Применённый промокод */
    const [appliedCoupon, setAppliedCoupon] = useState(null);

    /** @type {Array&lt;Object>} Доступные промокоды */
    const [coupons] = useState([
        { code: 'WELCOME10', discount: 10, valid: true },
        { code: 'SUMMER20', discount: 20, valid: true },
        { code: 'FREESHIP', discount: 0, valid: true, freeShipping: true }
    ]);

    /** @type {string} Текущий язык интерфейса ('ru') */
    const [language, setLanguage] = useState('ru');

    /** @type {string} Текущая валюта ('RUB') */
    const [currency, setCurrency] = useState('');

    // === Логика фильтрации товаров ===

    /**
     * Фильтрует товары по категориям, поиску, цене, бренду и рейтингу.
     * Учитывает мультиязычные названия и описания.
     *
     * @returns {Array&lt;Object>} Отфильтрованный список товаров
     */
    const filteredProducts = products.filter(product => {
        const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;

        const currentName = typeof product.name === 'object' ? product.name[language] : product.name;
        const currentDescription = typeof product.description === 'object' ? product.description[language] : product.description;

        const matchesSearch = currentName.toLowerCase().includes(searchTerm.toLowerCase()) ||
            currentDescription.toLowerCase().includes(searchTerm.toLowerCase()) ||
            product.brand.toLowerCase().includes(searchTerm.toLowerCase());

        const matchesPrice = product.price >= filters.priceRange[0] &amp;&amp; product.price &lt;= filters.priceRange[1];
        const matchesBrand = !filters.brand || product.brand.toLowerCase().includes(filters.brand.toLowerCase());
        const matchesRating = product.rating >= filters.rating;

        return matchesCategory &amp;&amp; matchesSearch &amp;&amp; matchesPrice &amp;&amp; matchesBrand &amp;&amp; matchesRating;
    });

    // === Функции управления состоянием ===

    /**
     * Добавляет товар в корзину. Если товар с такими опциями уже есть — увеличивает количество.
     *
     * @param {Object} product - Товар для добавления
     * @param {Object} selectedOptions - Выбранные опции (цвет, размер и т.д.)
     */
    const addToCart = (product, selectedOptions = {}) => {
        setCart(prev => {
            const existing = prev.find(item =>
                item.id === product.id &amp;&amp;
                JSON.stringify(item.selectedOptions) === JSON.stringify(selectedOptions)
            );

            if (existing) {
                return prev.map(item =>
                    item.id === product.id &amp;&amp;
                    JSON.stringify(item.selectedOptions) === JSON.stringify(selectedOptions)
                        ? { ...item, quantity: item.quantity + 1 }
                        : item
                );
            }

            return [...prev, {
                ...product,
                quantity: 1,
                selectedOptions,
                finalPrice: product.discount ? product.price * (1 - product.discount / 100) : product.price
            }];
        });

        // Добавить в "недавно просмотренные"
        if (!viewedProducts.some(p => p.id === product.id)) {
            setViewedProducts(prev => [product, ...prev].slice(0, 5));
        }

        // Анимация добавления
        setShowAddAnimation(true);
        setTimeout(() => setShowAddAnimation(false), 1500);
    };

    /**
     * Удаляет товар из корзины (по ID и опциям).
     *
     * @param {number} productId - ID товара
     * @param {Object|null} selectedOptions - Опции товара (если null — удаляет все варианты)
     */
    const removeFromCart = (productId, selectedOptions = null) => {
        setCart(prev => {
            if (selectedOptions === null) {
                return prev.filter(item => item.id !== productId);
            }
            return prev.filter(item =>
                !(item.id === productId &amp;&amp;
                    JSON.stringify(item.selectedOptions) === JSON.stringify(selectedOptions))
            );
        });
    };

    /**
     * Обновляет количество товара в корзине. Если 0 — удаляет.
     *
     * @param {number} productId - ID товара
     * @param {number} quantity - Новое количество
     * @param {Object|null} selectedOptions - Опции товара
     */
    const updateQuantity = (productId, quantity, selectedOptions = null) => {
        if (quantity === 0) {
            removeFromCart(productId, selectedOptions);
            return;
        }

        setCart(prev =>
            prev.map(item =>
                item.id === productId &amp;&amp;
                (selectedOptions === null || JSON.stringify(item.selectedOptions) === JSON.stringify(selectedOptions))
                    ? { ...item, quantity }
                    : item
            )
        );
    };

    /**
     * Добавляет/удаляет товар из избранного.
     *
     * @param {Object} product - Товар
     */
    const toggleFavorite = (product) => {
        setFavorites(prev =>
            prev.includes(product.id)
                ? prev.filter(id => id !== product.id)
                : [...prev, product.id]
        );
    };

    /**
     * Добавляет/удаляет товар из списка сравнения.
     *
     * @param {Object} product - Товар
     */
    const toggleCompare = (product) => {
        setCompareList(prev =>
            prev.includes(product.id)
                ? prev.filter(id => id !== product.id)
                : [...prev, product.id]
        );
    };

    /**
     * Применяет промокод.
     *
     * @param {string} code - Код промокода
     * @returns {boolean} Успешно ли применён
     */
    const applyCouponCode = (code) => {
        const coupon = coupons.find(c => c.code === code &amp;&amp; c.valid);
        if (coupon) {
            setAppliedCoupon(coupon);
            addNotification('coupon', `Промокод ${code} применен!`, 'success');
            return true;
        }
        addNotification('error', 'Неверный промокод', 'error');
        return false;
    };

    /**
     * Добавляет новое уведомление.
     *
     * @param {string} type - Тип уведомления ('sale', 'order', 'coupon', 'error')
     * @param {string} message - Текст сообщения
     * @param {string} severity - Уровень важности ('info', 'success', 'error')
     */
    const addNotification = (type, message, severity = 'info') => {
        const newNotification = {
            id: Date.now(),
            type,
            message,
            time: 'только что',
            read: false,
            severity
        };
        setNotifications(prev => [newNotification, ...prev]);
    };

    /**
     * Отправляет сообщение в чат.
     */
    const sendChatMessage = () => {
        if (chatInput.trim()) {
            setChatMessages(prev => [
                ...prev,
                {
                    id: Date.now(),
                    sender: 'user',
                    text: chatInput,
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                }
            ]);
            setChatInput('');

            // Имитация ответа бота
            setTimeout(() => {
                setChatMessages(prev => [
                    ...prev,
                    {
                        id: Date.now(),
                        sender: 'bot',
                        text: language === 'ru'
                            ? 'Спасибо за ваше сообщение! Наш менеджер свяжется с вами в ближайшее время.'
                            : 'Thank you for your message! Our manager will contact you shortly.',
                        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    }
                ]);
            }, 1000);
        }
    };

    /**
     * Запускает голосовой поиск (имитация).
     */
    const startVoiceSearch = () => {
        setShowVoiceSearch(true);
        setTimeout(() => {
            setSearchTerm(language === 'ru' ? 'смартфон' : 'smartphone');
            setShowVoiceSearch(false);
        }, 2000);
    };

    /**
     * Оформляет заказ: сохраняет в историю, очищает корзину, показывает модалку.
     */
    const completeOrder = () => {
        const totals = getCartTotals(cart, appliedCoupon);
        const newOrder = {
            id: Date.now(),
            items: cart,
            totals,
            delivery: orderForm.delivery,
            payment: orderForm.payment,
            status: 'processing',
            date: new Date().toISOString().split('T')[0]
        };

        setOrders(prev => [newOrder, ...prev]);
        setCart([]);
        setAppliedCoupon(null);
        setOrderForm({
            step: 1,
            delivery: { type: 'courier', address: '', city: '', phone: '' },
            payment: { method: 'card', cardNumber: '', expiry: '', cvv: '' }
        });
        setShowOrderModal(true);
        addNotification('order',
            language === 'ru'
                ? `Заказ №${newOrder.id.toString().slice(-6)} оформлен!`
                : `Order №${newOrder.id.toString().slice(-6)} confirmed!`,
            'success'
        );
    };

    /**
     * Вход пользователя.
     *
     * @param {string} email - Email
     * @param {string} password - Пароль
     */
    const login = (email, password) => {
        setUser({
            name: language === 'ru' ? 'Иван Петров' : 'Ivan Petrov',
            email,
            orders: 12,
            points: 1500,
            level: 'silver'
        });
        setCurrentPage('home');
    };

    /**
     * Выход из аккаунта.
     */
    const logout = () => {
        setUser(null);
        setCurrentPage('home');
    };

    // === Рендеринг страницы ===

    /**
     * Рендерит текущую страницу на основе `currentPage`.
     * Передаёт необходимые пропсы в зависимости от страницы.
     *
     * @returns {JSX.Element} Текущая страница
     */
    const renderPage = () => {
        switch (currentPage) {
            case 'product':
                return &lt;ProductPage
                    currentProduct={currentProduct}
                    setCurrentPage={setCurrentPage}
                    addToCart={addToCart}
                    toggleFavorite={toggleFavorite}
                    toggleCompare={toggleCompare}
                    favorites={favorites}
                    compareList={compareList}
                    products={products}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                />;
            case 'OrderModal':
                &lt;OrderModal
                    showOrderModal={showOrderModal}
                    setShowOrderModal={setShowOrderModal}
                    setCurrentPage={setCurrentPage}
                    language={language}
                    cart={cart}
                    getCartTotals={getCartTotals}
                    formatPrice={formatPrice}
                />
            case 'cart':
                return &lt;CartPage
                    cart={cart}
                    setCart={setCart}
                    appliedCoupon={appliedCoupon}
                    applyCouponCode={applyCouponCode}
                    setCurrentPage={setCurrentPage}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                    getCartTotals={getCartTotals}
                />;
            case 'checkout':
                return &lt;CheckoutPage
                    cart={cart}
                    orderForm={orderForm}
                    setOrderForm={setOrderForm}
                    appliedCoupon={appliedCoupon}
                    completeOrder={completeOrder}
                    setCurrentPage={setCurrentPage}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                    getCartTotals={getCartTotals}
                />;
            case 'orders':
                return &lt;OrdersPage
                    user={user}
                    orders={orders}
                    setCurrentPage={setCurrentPage}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                />;
            case 'login':
                return &lt;LoginPage
                    login={login}
                    setCurrentPage={setCurrentPage}
                    language={language}
                />;
            case 'favorites':
                return &lt;FavoritesPage
                    favorites={favorites}
                    setFavorites={setFavorites}
                    setCurrentPage={setCurrentPage}
                    products={products}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                    toggleFavorite={toggleFavorite}
                />;
            case 'compare':
                return &lt;ComparePage
                    compareList={compareList}
                    setCompareList={setCompareList}
                    setCurrentPage={setCurrentPage}
                    products={products}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                    toggleCompare={toggleCompare}
                />;
            default:
                return &lt;HomePage
                    products={filteredProducts}
                    categories={categories}
                    selectedCategory={selectedCategory}
                    setSelectedCategory={setSelectedCategory}
                    searchTerm={searchTerm}
                    setSearchTerm={setSearchTerm}
                    filters={filters}
                    setFilters={setFilters}
                    addToCart={addToCart}
                    toggleFavorite={toggleFavorite}
                    toggleCompare={toggleCompare}
                    favorites={favorites}
                    compareList={compareList}
                    setCurrentPage={setCurrentPage}
                    setCurrentProduct={setCurrentProduct}
                    language={language}
                    currency={currency}
                    formatPrice={formatPrice}
                />;
        }
    };

    // === Рендер UI ===

    return (
        &lt;div className="min-h-screen bg-gray-50">
            {/* Шапка сайта */}
            &lt;Header
                cart={cart}
                notifications={notifications}
                user={user}
                currentPage={currentPage}
                setCurrentPage={setCurrentPage}
                setShowChat={setShowChat}
                language={language}
                setLanguage={setLanguage}
                currency={currency}
                setCurrency={setCurrency}
                login={login}
                logout={logout}
                formatPrice={formatPrice}
            />

            {/* Хлебные крошки */}
            &lt;Breadcrumb
                currentPage={currentPage}
                currentProduct={currentProduct}
                setCurrentPage={setCurrentPage}
                language={language}
            />

            {/* Основной контент */}
            {renderPage()}

            {/* Виджет чата */}
            &lt;ChatWidget
                showChat={showChat}
                setShowChat={setShowChat}
                chatMessages={chatMessages}
                setChatMessages={setChatMessages}
                chatInput={chatInput}
                setChatInput={setChatInput}
                sendChatMessage={sendChatMessage}
                language={language}
            />

            {/* Анимация добавления в корзину */}
            &lt;AddToCartAnimation showAddAnimation={showAddAnimation} language={language} />

            {/* Модальное окно подтверждения заказа */}
            &lt;OrderModal
                showOrderModal={showOrderModal}
                setShowOrderModal={setShowOrderModal}
                setCurrentPage={setCurrentPage}
                language={language}
            />

            {/* Футер */}
            &lt;Footer language={language} />
        &lt;/div>
    );
};

export default App;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-helpers.html">helpers</a></li><li><a href="module-seo.html">seo</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AddToCartAnimation">AddToCartAnimation</a></li><li><a href="global.html#Breadcrumb">Breadcrumb</a></li><li><a href="global.html#CartPage">CartPage</a></li><li><a href="global.html#CartSidebar">CartSidebar</a></li><li><a href="global.html#ChatWidget">ChatWidget</a></li><li><a href="global.html#CheckoutPage">CheckoutPage</a></li><li><a href="global.html#FavoritesPage">FavoritesPage</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#HomePage">HomePage</a></li><li><a href="global.html#LoginPage">LoginPage</a></li><li><a href="global.html#OrderModal">OrderModal</a></li><li><a href="global.html#OrdersPage">OrdersPage</a></li><li><a href="global.html#ProductCard">ProductCard</a></li><li><a href="global.html#ProductPage">ProductPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Aug 30 2025 18:54:15 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
