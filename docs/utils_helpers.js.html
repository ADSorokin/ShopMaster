<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/helpers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/helpers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Утилиты для форматирования цен и подсчёта итогов корзины.
 *
 * @module helpers
 * @requires ../data/currencies - Список валют и курсов
 */

// Импорт данных о валютах
import { currencies } from '../data/currencies';

/**
 * Форматирует цену с учётом валюты и курса.
 *
 * @param {number} price - Цена в базовой валюте (RUB)
 * @param {string} [currency='RUB'] - Код валюты ('RUB', 'USD', 'EUR')
 * @returns {string} Отформатированная строка с символом валюты
 *
 * @example
 * formatPrice(1999, 'RUB'); // → "1 999 ₽"
 * formatPrice(1999, 'USD'); // → "$28.56"
 * formatPrice(1999, 'EUR'); // → "€26.78"
 *
 * @description
 * Логика:
 * - Получает курс валюты из `currencies`
 * - Умножает цену на курс
 * - Форматирует по правилам:
 *   - RUB: округление, разделитель тысяч, символ ₽
 *   - USD/EUR: 2 знака после запятой, символ $/€
 * - Если валюта неизвестна — возвращает цену в рублях
 */
export const formatPrice = (price, currency = 'RUB') => {
    const currencyInfo = currencies.find(c => c.code === currency);

    if (!currencyInfo) {
        console.warn(`Валюта ${currency} не найдена. Используется RUB.`);
        return price.toLocaleString('ru-RU') + ' ₽';
    }

    const convertedPrice = price * currencyInfo.rate;

    if (currency === 'RUB') {
        return Math.round(convertedPrice).toLocaleString('ru-RU') + ' ₽';
    } else if (currency === 'USD') {
        return '$' + convertedPrice.toFixed(2);
    } else if (currency === 'EUR') {
        return '€' + convertedPrice.toFixed(2);
    }

    // Резервный формат (на случай новых валют)
    return convertedPrice.toLocaleString('ru-RU') + ' ₽';
};

/**
 * Подсчитывает итоговые суммы корзины: скидку, доставку, общую сумму.
 *
 * @param {Array&lt;Object>} cart - Массив товаров в корзине
 * @param {Object|null} [appliedCoupon=null] - Применённый промокод
 * @returns {Object} Объект с итогами
 * @property {number} subtotal - Сумма до скидок (цена × количество)
 * @property {number} discount - Сумма скидки
 * @property {number} shipping - Стоимость доставки
 * @property {number} total - Итоговая сумма к оплате
 *
 * @example
 * const totals = getCartTotals(cart, { discount: 10, freeShipping: true });
 * console.log(totals); // { subtotal: 10000, discount: 1000, shipping: 0, total: 9000 }
 *
 * @description
 * Поведение:
 * - Сумма товаров: `finalPrice × quantity`
 * - Скидка: если `appliedCoupon.discount` — процент от `subtotal`
 * - Доставка: 500 ₽, или 0 ₽ при `appliedCoupon.freeShipping`
 * - Итог: `subtotal - discount + shipping`
 */
export const getCartTotals = (cart, appliedCoupon = null) => {
    // Сумма товаров
    const subtotal = cart.reduce((total, item) => {
        return total + (item.finalPrice * item.quantity);
    }, 0);

    // Скидка (в рублях)
    const discount = appliedCoupon &amp;&amp; appliedCoupon.discount
        ? subtotal * (appliedCoupon.discount / 100)
        : 0;

    // Доставка
    const shipping = appliedCoupon?.freeShipping ? 0 : 500;

    // Итоговая сумма
    const total = Math.max(subtotal - discount + shipping, 0);

    return {
        subtotal: Math.round(subtotal),
        discount: Math.round(discount),
        shipping,
        total: Math.round(total)
    };
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-helpers.html">helpers</a></li><li><a href="module-seo.html">seo</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AddToCartAnimation">AddToCartAnimation</a></li><li><a href="global.html#Breadcrumb">Breadcrumb</a></li><li><a href="global.html#CartPage">CartPage</a></li><li><a href="global.html#CartSidebar">CartSidebar</a></li><li><a href="global.html#ChatWidget">ChatWidget</a></li><li><a href="global.html#CheckoutPage">CheckoutPage</a></li><li><a href="global.html#FavoritesPage">FavoritesPage</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#HomePage">HomePage</a></li><li><a href="global.html#LoginPage">LoginPage</a></li><li><a href="global.html#OrderModal">OrderModal</a></li><li><a href="global.html#OrdersPage">OrdersPage</a></li><li><a href="global.html#ProductCard">ProductCard</a></li><li><a href="global.html#ProductPage">ProductPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Aug 30 2025 18:54:15 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
